




## Concurrency Control in PostgreSQL - MVCC, S2PL, OCC (2)



### Inserting, Deleting and Updating Tuples

https://www.interdb.jp/pg/pgsql05/03.html


![[Screenshot 2025-12-15 at 3.40.35 AM.png|700]]


#### Insertion

![[Screenshot 2025-12-15 at 3.40.56 AM.png|700]]

데이터를 insert 할때, 대상이 되는 테이블의 페이지에 바로 새로운 tuple 이 생성된다.
txid 가 99인 트랜잭션에 의해 해당 tuple 이 insert (생성) 된다고 했을때
해당 tuple 의 헤더는 위와같이 생성된다.

t_xmin 에는 해당 튜플을 생성한 transaction 의 id가, 
t_max 에는 0 이 (아직 튜플이 업데이트되거나 삭제되지 않았다는 것을 의미, invalid)
t_cid 에는 0이 (해당 트랜잭션의 첫번째 statement 에서 추가됨을 의미)
t_ctid 에는 (0, 1) 이 설정되는데 이는 자기 스스로를 뜻하고, 이 tuple 이 해당 데이터의 대한 가장 마지막 버전이기때문에 그렇다.
	(0, 1) 의 0과 1이 각각 무엇을 의미하는지는 아직 불명


#### Deletion




## PostgreSQL 의 Table-Level Lock

여기서 row 라는 단어가 들어간다 하더라도 테이블 레벨 락임을 명심해야 함

https://www.postgresql.org/docs/current/explicit-locking.html
https://www.perplexity.ai/search/https-www-postgresql-org-docs-nklBUqytQ2eyuvRPNkRKXQ

### ACCESS SHARE



### ROW SHARE



### ROW EXCLUSIVE


### SHARE UPDATE EXCLUSIVE


### SHARE (ShareLock)


### SHARE ROW EXCLUSIVE


### Exclusive


### Access Exclusive






## PostgreSQL 의 Row-Level Locks


### FOR UPDATE


### FOR NO KEY UPDATE


### FOR SHARE



### FOR KEY SHARE


## Page Level Locks


