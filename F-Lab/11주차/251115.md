## DI

### @Autowired 
-> spring annotation, íƒ€ì… ë§¤ì¹­ ìš°ì„ , id ë§¤ì¹­ ë‚˜ì¤‘ì— (í•„ë“œ ì´ë¦„)
	@Qualifier ë¡œ id ë¥¼ í•„ë“œ ì´ë¦„ì´ ì•„ë‹ˆë¼ ë³„ë„ë¡œ ì„¤ì •í•´ì¤„ ìˆ˜ ìˆìŒ.
		@Qualifier ì•ˆì— ë“¤ì–´ê°€ëŠ” í…ìŠ¤íŠ¸ëŠ” íƒ€ì…ë³„ë¡œ ë‚˜ë‰¨. ê·¸ëŸ¬ë‹ˆê¹Œ ê°™ì€ ì´ë¦„ì´ì–´ë„ íƒ€ì…ì´ ë‹¤ë¥´ë©´
		Spring
### @Resource 
-> ìë°” í‘œì¤€ annotation, id ë§¤ì¹­ ìš°ì„ , íƒ€ì… ë§¤ì¹­ ë‚˜ì¤‘ì—.
ì´ë¦„ ê¸°ë°˜.

```java
@Resource(name = "specificBean")
private MyService myService;
```


### @Inject 
-> ë§ˆì°¬ê°€ì§€ë¡œ ìë°” í‘œì¤€ annotation
-> íƒ€ì… ê¸°ë°˜.
@autorwired ì™€ ê±°ì˜ ë™ì¼í•œ ë°©ì‹

ë™ì¼ íƒ€ì… ì—¬ëŸ¬ê°œë©´ @named ë¡œ ì„¤ì •


#### @Autowired ì™€ì˜ ì°¨ì´ì 

@Autowird : @required ì§€ì›

- @Required : ì˜ì¡´ì„± ì£¼ì…ì´ í•„ìˆ˜ì¸ì§€ ì•„ë‹Œì§€ í™•ì¸.
  ë§¤ì¹­ë˜ëŠ” Bean ëª»ì°¾ìœ¼ë©´ ì—ëŸ¬ ë°œìƒ
	
	required = falseë¡œ ì„¤ì •í•œ ê²½ìš°
		@Autowired(required = false)ë¡œ ì„¤ì •í•˜ë©´ ë§¤ì¹­ë˜ëŠ” beanì´ ì»¨í…Œì´ë„ˆì— ì—†ì–´ë„ ì˜ˆì™¸ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ì‹  ë‹¤ìŒê³¼ ê°™ì€ ë™ì‘ì„ í•œë‹¤:â€‹
			setter ë©”ì„œë“œì˜ ê²½ìš°: ìë™ ì£¼ì… ë©”ì„œë“œ ìì²´ê°€ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤
			í•„ë“œ ì£¼ì…ì˜ ê²½ìš°: í•´ë‹¹ í•„ë“œëŠ” ì´ˆê¸°í™”ë˜ì§€ ì•Šê³  null ìƒíƒœë¡œ ë‚¨ëŠ”ë‹¤.
			ìƒì„±ì ì£¼ì…ì˜ ê²½ìš°: ìƒì„±ìê°€ í˜¸ì¶œë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤
		
	required = falseëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê²½ìš°ì— ìœ ìš©í•˜ë‹¤:â€‹
		ì„ íƒì  ê¸°ëŠ¥(optional features): í”ŒëŸ¬ê·¸ì¸ ê°™ì€ ì„ íƒì  ì»´í¬ë„ŒíŠ¸ë¥¼ ì£¼ì…í•  ë•Œ
		í”„ë¡œí•„ë³„ ì„¤ì •: íŠ¹ì • í”„ë¡œí•„ì—ì„œë§Œ í™œì„±í™”ë˜ëŠ” beanì„ ì£¼ì…í•  ë•Œ	
		í…ŒìŠ¤íŠ¸ í™˜ê²½: í…ŒìŠ¤íŠ¸ ì‹œ ì¼ë¶€ ì˜ì¡´ì„±ì´ ë¶ˆí•„ìš”í•œ ê²½ìš°â€‹
		ë‹¤í˜•ì„± ì²˜ë¦¬: ì—¬ëŸ¬ êµ¬í˜„ì²´ ì¤‘ í•˜ë‚˜ë§Œ ì„ íƒì ìœ¼ë¡œ ì£¼ì…ë°›ì„ ë•Œ
		
	Spring 5 ë¶€í„°ëŠ” @Nullable ì‚¬ìš© ê°€ëŠ¥
	
	ì •ë§í•„ìš”í•œ ê²½ìš°ê°€ ì•„ë‹ˆë¼ë©´ required = falseë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ë‹¤. ë¼ëŠ”ê²Œ ì±…ì˜ ì˜ê²¬ 


@Qualifier vs @Named
ê°™ìŒ


#### @Autowired ëŒ€ì‹  @Inject ë¥¼ ì¨ì•¼ë§Œ í•˜ëŠ” ê²½ìš°

> "Using JSR-330 annotations can help you ease the migration to the JEE 6 container or other compatible IoC container for example, Google Guice away from Spring"

Framework ë…ë¦½ì„±ì´ í•„ìš”í•œ ê²½ìš°

JSR-330 í‘œì¤€ ì¤€ìˆ˜ê°€ ìš”êµ¬ì‚¬í•­ì¸ ê²½ìš°

Provider ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•œ ì§€ì—° ì£¼ì…ì´ í•„ìš”í•œ ê²½ìš°

```java
@Inject
private Provider<MyService> myServiceProvider;

public void someMethod() {
    MyService service = myServiceProvider.get(); // í•„ìš”í•  ë•Œ ê°€ì ¸ì˜´
}
```
`Provider`ë¥¼ ì‚¬ìš©í•˜ë©´ ë¹ˆì„ ì§€ì—°í•´ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.Â `@Autowired`ë„ ê°€ëŠ¥í•˜ì§€ë§Œ,Â `@Inject`ê°€ JSR-330 í‘œì¤€ìœ¼ë¡œ ì •ì˜í•œ ë°©ì‹ì´ë‹¤.

ë‘ ì• ë…¸í…Œì´ì…˜ ëª¨ë‘ ë‚´ë¶€ì ìœ¼ë¡œ ë™ì¼í•œÂ `AutowiredAnnotationBeanPostProcessor`ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ë™ì‘ì€ ê±°ì˜ ë™ì¼í•˜ë‹¤.

## JPA

JPA ê¸°ë³¸ ê°œë…ê³¼ Spring Data JPA ì ìš©

---

#### JPA ê¸°ë³¸ ê°œë…

JPA(Java Persistence API)ëŠ” ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì„ ì •ì˜í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ì ìë°” ORM ê¸°ìˆ ì˜ í‘œì¤€ì…ë‹ˆë‹¤. ORM(Object Relational Mapping)ì€ ê°ì²´ëŠ” ê°ì²´ëŒ€ë¡œ, ê´€ê³„í˜• DBëŠ” ê´€ê³„í˜• DBëŒ€ë¡œ ì„¤ê³„í•˜ê³  ì¤‘ê°„ì—ì„œ ORM í”„ë ˆì„ì›Œí¬ê°€ ë§¤í•‘ ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. JPAëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ JDBC(Java Database Connectivity) ì‚¬ì´ì—ì„œ ë™ì‘í•©ë‹ˆë‹¤.

---

#### JPAì˜ í•µì‹¬ íŠ¹ì§•

JPAëŠ” íŠ¹ë³„í•œ ìŠˆí¼í´ë˜ìŠ¤ë‚˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†/êµ¬í˜„í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. ì¼ë°˜ POJO(Plain Old Java Object) í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ persistenceë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìœ¼ë©°, `new` ì—°ì‚°ìë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë‚˜ í”„ë ˆì  í…Œì´ì…˜ ë ˆì´ì–´ì—ì„œë„ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. JPAëŠ” persistence ê´€ë ¨ ì‘ì—…ì„ generic persistence manager APIë¡œ ì™¸ë¶€í™”í•˜ë¯€ë¡œ, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì½”ë“œê°€ ë°ì´í„° ì €ì¥ ê³„ì¸µì„ ì˜ì‹í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

---

#### ì²« ë²ˆì§¸ Entity í´ë˜ìŠ¤ ì‘ì„±

##### Entityì™€ Id ì–´ë…¸í…Œì´ì…˜

```java
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.GeneratedValue;

@Entity
public class Item {
    @Id
    @GeneratedValue(generator = "ID_GENERATOR")
    protected Long id;
    
    protected String name;
    
    // ìƒì„±ì
    protected Item() {} // JPA í•„ìˆ˜: no-argument ìƒì„±ì
    
    public Item(String name) {
        this.name = name;
    }
    
    // Getter/Setter
    public Long getId() {
        return id;
    }
    
    public String getName() {
        return name;
    }
    
    public void setName(String name) {
        this.name = name;
    }
}
```

---

#### ì£¼ìš” ê·œì¹™

##### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

í•„ìˆ˜ ìš”êµ¬ì‚¬í•­ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- Entity í´ë˜ìŠ¤ëŠ” `@Entity` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ í‘œì‹œí•´ì•¼ í•©ë‹ˆë‹¤.
    
- ëª¨ë“  entity í´ë˜ìŠ¤ëŠ” `@Id` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì‹ë³„ì ì†ì„±ì„ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤.
    
- í´ë˜ìŠ¤ì™€ ë©”ì„œë“œëŠ” `final`ë¡œ ì„ ì–¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
    
- ì¸ìê°€ ì—†ëŠ” ìƒì„±ì(no-argument constructor)ê°€ í•„ìš”í•©ë‹ˆë‹¤. ìƒì„±ìëŠ” ìµœì†Œí•œ package-visibleì´ì–´ì•¼ í•˜ì§€ë§Œ, publicìœ¼ë¡œ ì„ ì–¸í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.
    

##### ê¶Œì¥ì‚¬í•­

ê¶Œì¥ì‚¬í•­ìœ¼ë¡œëŠ”

- ì†ì„± í•„ë“œë¥¼ `private` ë˜ëŠ” `protected`ë¡œ ì„ ì–¸í•˜ê³ , getter/setter ë©”ì„œë“œë¥¼ í†µí•´ ì ‘ê·¼í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
    
- ì»¬ë ‰ì…˜ íƒ€ì… ì†ì„±ì€ `java.util.Set`, `java.util.List`, `java.util.Collection` ê°™ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ë©°, `HashSet` ê°™ì€ êµ¬ì²´ì ì¸ êµ¬í˜„ì²´ë¥¼ ì‚¬ìš©í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.
    

---

#### ê¸°ë³¸ ë§¤í•‘ ì–´ë…¸í…Œì´ì…˜

##### í…Œì´ë¸”ê³¼ ì»¬ëŸ¼ ë§¤í•‘

```java
@Entity
@Table(name = "ITEM")
public class Item {
    @Id
    @GeneratedValue(generator = "ID_GENERATOR")
    @Column(name = "ID")
    protected Long id;
    
    @Column(name = "NAME", nullable = false, length = 100)
    protected String name;
    
    @Column(name = "PRICE")
    protected BigDecimal price;
}
```

`@Table` ì–´ë…¸í…Œì´ì…˜ì€ ì—”í‹°í‹° í´ë˜ìŠ¤ì— ë§¤í•‘í•  í…Œì´ë¸” ì •ë³´ë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ìƒëµí•˜ë©´ í´ë˜ìŠ¤ ì´ë¦„ì„ í…Œì´ë¸” ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. `@Column` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ í•„ë“œì™€ ë§¤í•‘í•  í…Œì´ë¸”ì˜ ì»¬ëŸ¼ ì´ë¦„, null í—ˆìš© ì—¬ë¶€, ê¸¸ì´ ë“±ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

#### ì‹ë³„ì (p key) ìƒì„± ì „ëµ

-> ì—¬ê¸°ì„œ ì‹ë³„ìëŠ” í…Œì´ë¸”ì˜ ê° ë ˆì½”ë“œë¥¼ ê³ ìœ í•˜ê²Œ ë¶„ë¦¬í•˜ëŠ” ê°’ì„ ë§í•œë‹¤.

##### GeneratedValue ì„¤ì •

```java
// package-info.javaì— generator ì„¤ì •
@org.hibernate.annotations.GenericGenerator(
    name = "ID_GENERATOR",
    strategy = "enhanced-sequence",
    parameters = {
        @org.hibernate.annotations.Parameter(
            name = "sequence_name",
            value = "ITEM_SEQUENCE"
        ),
        @org.hibernate.annotations.Parameter(
            name = "initial_value",
            value = "1000"
        )
    })
package com.yourproject.model;
```

ê¶Œì¥ ì „ëµì€ `enhanced-sequence`ì…ë‹ˆë‹¤. ì´ ì „ëµì€ ë°ì´í„°ë² ì´ìŠ¤ê°€ sequenceë¥¼ ì§€ì›í•˜ë©´ ì‹¤ì œ database sequenceë¥¼ ì‚¬ìš©í•˜ê³ , ì§€ì›í•˜ì§€ ì•Šìœ¼ë©´ ë³„ë„ì˜ sequence í…Œì´ë¸”ë¡œ í´ë°±í•©ë‹ˆë‹¤. ì‹ë³„ì ê°’ì„ INSERT ì „ì— ìƒì„±í•  ìˆ˜ ìˆì–´ portableí•˜ë©° ìœ ì—°í•©ë‹ˆë‹¤.

---

#### ì£¼ìš” ìƒì„± ì „ëµ

JPA í‘œì¤€ ì „ëµìœ¼ë¡œëŠ” `GenerationType.AUTO`(ìë™ ì„ íƒ), `GenerationType.SEQUENCE`(ë°ì´í„°ë² ì´ìŠ¤ sequence ì‚¬ìš©), `GenerationType.IDENTITY`(auto-increment ì»¬ëŸ¼ ì‚¬ìš©), `GenerationType.TABLE`(ë³„ë„ í…Œì´ë¸” ì‚¬ìš©)ì´ ìˆìŠµë‹ˆë‹¤.

ì‹ë³„ì íƒ€ì…ì€ `Long`ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤. `int`ë‚˜ `short` ê°™ì€ ì‘ì€ íƒ€ì…ì€ ë²”ìœ„ ì œí•œìœ¼ë¡œ ì¸í•´ ì¥ê¸°ì ìœ¼ë¡œ ë¬¸ì œê°€ ë  ìˆ˜ ìˆìœ¼ë©°, `Integer`ë³´ë‹¤ `Long`ì´ í›¨ì”¬ ê¸´ ê¸°ê°„ ë™ì•ˆ ì‹ë³„ìë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

#### Entity ê´€ê³„ ë§¤í•‘

##### ë‹¤ëŒ€ì¼(ManyToOne) ê´€ê³„

```java
@Entity
public class Bid {
    @Id
    @GeneratedValue(generator = "ID_GENERATOR")
    protected Long id;
    
    @Column(nullable = false)
    protected BigDecimal amount;
    
    @ManyToOne(optional = false, fetch = FetchType.LAZY)
    protected Item item;
    
    @ManyToOne(optional = false, fetch = FetchType.LAZY)
    protected User bidder;
    
    // ìƒì„±ì
    protected Bid() {}
    
    public Bid(Item item, User bidder, BigDecimal amount) {
        this.item = item;
        this.bidder = bidder;
        this.amount = amount;
        // ì–‘ë°©í–¥ ê´€ê³„ ì„¤ì •
        item.getBids().add(this);
    }
}
```

##### ì¼ëŒ€ë‹¤(OneToMany) ì–‘ë°©í–¥ ê´€ê³„

```java
@Entity
public class Item {
    @Id
    @GeneratedValue(generator = "ID_GENERATOR")
    protected Long id;
    
    @OneToMany(mappedBy = "item")
    protected Set<Bid> bids = new HashSet<>();
    
    public Set<Bid> getBids() {
        return bids;
    }
    
    // ê´€ê³„ ê´€ë¦¬ í¸ì˜ ë©”ì„œë“œ
    public void addBid(Bid bid) {
        bids.add(bid);
        bid.setItem(this);
    }
}
```

ì–‘ë°©í–¥ ê´€ê³„ ê´€ë¦¬ì—ì„œ ì¤‘ìš”í•œ ì ì€ ì»¬ë ‰ì…˜ íƒ€ì… ì†ì„±ì€ ì¸í„°í˜ì´ìŠ¤(`Set`, `List`)ë¡œ ì„ ì–¸í•´ì•¼ í•˜ë©°, ë¹ˆ ì»¬ë ‰ì…˜ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì—¬ NullPointerExceptionì„ ë°©ì§€í•´ì•¼ í•©ë‹ˆë‹¤. ì–‘ë°©í–¥ ê´€ê³„ì—ì„œëŠ” ì–‘ìª½ ëª¨ë‘ë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ í•˜ë¯€ë¡œ í¸ì˜ ë©”ì„œë“œ(convenience method)ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. `mappedBy` ì†ì„±ìœ¼ë¡œ ê´€ê³„ì˜ ì£¼ì¸ì„ ì§€ì •í•©ë‹ˆë‹¤.

---

#### Spring Data JPA ê¸°ë³¸

##### Repository ì¸í„°í˜ì´ìŠ¤

```java
import org.springframework.data.jpa.repository.JpaRepository;

public interface ItemRepository extends JpaRepository<Item, Long> {
    // ê¸°ë³¸ CRUD ë©”ì„œë“œ ìë™ ì œê³µ
    // findById, findAll, save, delete ë“±
    
    // ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ì¿¼ë¦¬ ìƒì„±
    List<Item> findByNameContaining(String keyword);
    
    List<Item> findByPriceBetween(BigDecimal min, BigDecimal max);
}
```

Spring Data JPAëŠ” `JpaRepository`ë¥¼ ìƒì†í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜í•˜ë©´ ê¸°ë³¸ CRUD ë©”ì„œë“œë¥¼ ìë™ìœ¼ë¡œ ì œê³µí•©ë‹ˆë‹¤. ë©”ì„œë“œ ì´ë¦„ ê·œì¹™ì— ë”°ë¼ ì¿¼ë¦¬ë¥¼ ìë™ ìƒì„±í•˜ëŠ” ê¸°ëŠ¥ë„ ì§€ì›í•©ë‹ˆë‹¤.

---

#### Entity Manager ì‚¬ìš©

```java
@Service
public class ItemService {
    @PersistenceContext
    private EntityManager em;
    
    @Transactional
    public void createItem(String name) {
        Item item = new Item(name);
        em.persist(item); // ì €ì¥
    }
    
    public Item findItem(Long id) {
        return em.find(Item.class, id); // ì¡°íšŒ
    }
}
```

EntityManagerëŠ” JPAì˜ í•µì‹¬ ì¸í„°í˜ì´ìŠ¤ë¡œ persistence ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. `persist()`ëŠ” entityë¥¼ ì €ì¥í•˜ê³ , `find()`ëŠ” primary keyë¡œ ì¡°íšŒí•˜ë©°, `remove()`ëŠ” ì‚­ì œí•©ë‹ˆë‹¤.

-> Spring JPA ì—ì„œëŠ” Entity Manager ì•ˆì”€ 

---

### Spring Data JPAë€?

Spring Data JPAëŠ” Spring í”„ë ˆì„ì›Œí¬ì—ì„œ JPAë¥¼ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” ëª¨ë“ˆì…ë‹ˆë‹¤. ì´ ëª¨ë“ˆì˜ í•µì‹¬ ëª©ì ì€ ìë°” ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ JPA(Java Persistence API)ë¥¼ ë” ê°„í¸í•˜ê²Œ í™œìš©í•  ìˆ˜ ìˆë„ë¡, ë°ì´í„°ë² ì´ìŠ¤ì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” ì½”ë“œë¥¼ ë‹¨ìˆœí™”ì‹œí‚¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

#### Repository ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜

ê°œë°œìëŠ” ë°ì´í„° ì ‘ê·¼ ê³„ì¸µì„ ì‘ì„±í•  ë•Œ, JpaRepositoryì™€ ê°™ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ëŠ” ê²ƒë§Œìœ¼ë¡œ ê¸°ë³¸ì ì¸ CRUD(Create, Read, Update, Delete) ê¸°ëŠ¥ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆ) public interface SeatRepository extends JpaRepository<Seat, Long> {}

#### ìë™ ì¿¼ë¦¬ ìƒì„±

ë©”ì„œë“œì˜ ì´ë¦„ë§Œ ì˜ ì‘ì„±í•˜ë©´, Spring Data JPAê°€ ê·¸ì— ë§ëŠ” SQL/JPA ì¿¼ë¦¬ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•´ì¤ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `findBySeatNumber`ë¥¼ ì •ì˜í•˜ë©´ seatNumber ê¸°ì¤€ìœ¼ë¡œ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ê°€ ìë™ ì™„ì„±ë©ë‹ˆë‹¤.

#### EntityManager ì§ì ‘ ì‚¬ìš©í•  í•„ìš” ì—†ìŒ

ë³µì¡í•œ ì—”í‹°í‹° ë§¤ë‹ˆì €ë‚˜ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ë¥¼ ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ í•´ì£¼ë¯€ë¡œ, ê°œë°œìëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì§‘ì¤‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ì ê¹ ì •ë¦¬í•˜ë©´

Spring Data JPAëŠ” JPA í‘œì¤€ì˜ ë³µì¡í•¨ì„ ê°ì¶”ê³  ë‹¨ìˆœí•˜ê³  ë¹ ë¥´ê²Œ ë°ì´í„°ë² ì´ìŠ¤ CRUDì™€ ì§ˆì˜ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.

---

### Spring Data JPAì—ì„œ Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ ì–´ë–»ê²Œ ì •ì˜í•˜ëŠ”ì§€

Spring Data JPAì—ì„œ ê°€ì¥ ë¨¼ì € í•´ì•¼ í•  ì¼ì€ Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜í•˜ë©´, Spring Data JPAê°€ ìë™ìœ¼ë¡œ êµ¬í˜„ì²´ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.

#### ê¸°ë³¸ í˜•íƒœ

```java
import org.springframework.data.jpa.repository.JpaRepository;

public interface SeatRepository extends JpaRepository<Seat, Long> {
    // ë©”ì„œë“œë¥¼ í•˜ë‚˜ë„ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ê¸°ë³¸ CRUD ë©”ì„œë“œê°€ ìë™ìœ¼ë¡œ ì œê³µë¨
}
```

#### ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ë¶€ë¶„

`JpaRepository<Seat, Long>`: ì œë„¤ë¦­ íƒ€ì… ë‘ ê°œë¥¼ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.

- **ì²« ë²ˆì§¸(Seat)**: ì´ Repositoryê°€ ë‹¤ë£° Entity í´ë˜ìŠ¤
    
- **ë‘ ë²ˆì§¸(Long)**: Entityì˜ ID(ê¸°ë³¸í‚¤) íƒ€ì…
    

ì´ê²Œ ì „ë¶€ì…ë‹ˆë‹¤. ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì •ì˜í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ Springì´ ìë™ìœ¼ë¡œ êµ¬í˜„ì²´ë¥¼ ë§Œë“¤ì–´ì£¼ê³ , ë‹¤ìŒê³¼ ê°™ì€ ë©”ì„œë“œë“¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

#### Query Method: ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ì¿¼ë¦¬ ìë™ ìƒì„±

Spring Data JPAì˜ ê°€ì¥ ê°•ë ¥í•œ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ëŠ” ë©”ì„œë“œ ì´ë¦„ë§Œìœ¼ë¡œ ì¿¼ë¦¬ê°€ ìë™ ìƒì„±ëœë‹¤ëŠ” ì ì…ë‹ˆë‹¤. SQLì´ë‚˜ JPQLì„ ì‘ì„±í•˜ì§€ ì•Šì•„ë„, ë©”ì„œë“œ ì´ë¦„ ê·œì¹™ì— ë”°ë¼ Springì´ ìë™ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.

##### ê¸°ë³¸ êµ¬ì¡°

Query Methodì˜ ì´ë¦„ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:


```
findBy + í•„ë“œëª… + (ì¡°ê±´í‚¤ì›Œë“œ)
```

ì˜ˆì‹œë¥¼ ë³´ë©´ ë°”ë¡œ ì´í•´ë©ë‹ˆë‹¤:

```java
public interface SeatRepository extends JpaRepository<Seat, Long> {
    
    // seatNumberë¡œ ì¡°íšŒ
    Seat findBySeatNumber(String seatNumber);
    
    // ì´ ë©”ì„œë“œ ì´ë¦„ë§Œìœ¼ë¡œ Springì´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ì¿¼ë¦¬ ìƒì„±:
    // SELECT * FROM seat WHERE seat_number = ?
}
```

##### ì£¼ìš” í‚¤ì›Œë“œ

**ì¡°íšŒ í‚¤ì›Œë“œ**

`findBy`, `readBy`, `queryBy`, `getBy`ëŠ” ëª¨ë‘ ê°™ì€ ì˜ë¯¸ì…ë‹ˆë‹¤. ì–´ë–¤ ê±¸ ì¨ë„ ë˜‘ê°™ì´ ì¡°íšŒ ì¿¼ë¦¬ê°€ ìƒì„±ë©ë‹ˆë‹¤.

```java
// ì´ ë„¤ ê°œëŠ” ì™„ì „íˆ ë™ì¼í•©ë‹ˆë‹¤
List<Seat> findBySeatNumber(String seatNumber);
List<Seat> readBySeatNumber(String seatNumber);
List<Seat> queryBySeatNumber(String seatNumber);
List<Seat> getBySeatNumber(String seatNumber);
```

**ì¡°ê±´ í‚¤ì›Œë“œ**

ê°™ìŒ í™•ì¸:

```java
// seatNumberê°€ ì •í™•íˆ ì¼ì¹˜
Seat findBySeatNumber(String seatNumber);

// isAvailableì´ trueì¸ì§€ í™•ì¸
List<Seat> findByIsAvailableTrue();

// priceê°€ nullì¸ì§€ í™•ì¸
List<Seat> findByPriceIsNull();
```

ë¶€ë¶„ ì¼ì¹˜ (Like ê²€ìƒ‰):

```java
// seatNumberì— íŠ¹ì • ë¬¸ìì—´ í¬í•¨
List<Seat> findBySeatNumberContaining(String keyword);

// seatNumberê°€ íŠ¹ì • ë¬¸ìì—´ë¡œ ì‹œì‘
List<Seat> findBySeatNumberStartingWith(String prefix);

// seatNumberê°€ íŠ¹ì • ë¬¸ìì—´ë¡œ ëë‚¨
List<Seat> findBySeatNumberEndingWith(String suffix);
```

ë¹„êµ ì—°ì‚°:

```java
// priceê°€ íŠ¹ì • ê°’ë³´ë‹¤ í°
List<Seat> findByPriceGreaterThan(BigDecimal price);

// priceê°€ íŠ¹ì • ê°’ë³´ë‹¤ ì‘ì€
List<Seat> findByPriceLessThan(BigDecimal price);

// priceê°€ ë²”ìœ„ ì•ˆì— ìˆëŠ”
List<Seat> findByPriceBetween(BigDecimal min, BigDecimal max);
```

**ì—¬ëŸ¬ ì¡°ê±´ ì¡°í•©**

`And`ì™€ `Or`ë¡œ ì—¬ëŸ¬ ì¡°ê±´ì„ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```java
// seatNumberì™€ isAvailable ë‘˜ ë‹¤ ë§Œì¡±
Seat findBySeatNumberAndIsAvailable(String seatNumber, boolean available);

// seatNumber ë˜ëŠ” row ì¤‘ í•˜ë‚˜ë§Œ ë§Œì¡±
List<Seat> findBySeatNumberOrRow(String seatNumber, String row);

// ë³µì¡í•œ ì¡°í•©ë„ ê°€ëŠ¥
List<Seat> findByRowAndIsAvailableTrueAndPriceGreaterThan(
    String row, BigDecimal price);
```

##### ì‹¤ì „ ì˜ˆì‹œ

PulseTicket í”„ë¡œì íŠ¸ì— ì ìš©í•œë‹¤ë©´:

```java
public interface SeatRepository extends JpaRepository<Seat, Long> {
    
    // ì¢Œì„ ë²ˆí˜¸ë¡œ ì°¾ê¸°
    Seat findBySeatNumber(String seatNumber);
    
    // ì˜ˆì•½ ê°€ëŠ¥í•œ ì¢Œì„ë§Œ ì¡°íšŒ
    List<Seat> findByIsAvailableTrue();
    
    // íŠ¹ì • í–‰(row)ì˜ ì˜ˆì•½ ê°€ëŠ¥í•œ ì¢Œì„ ì¡°íšŒ
    List<Seat> findByRowAndIsAvailableTrue(String row);
    
    // ê°€ê²© ë²”ìœ„ë¡œ ì¢Œì„ ì°¾ê¸°
    List<Seat> findByPriceBetween(BigDecimal minPrice, BigDecimal maxPrice);
}
```

í•µì‹¬ì€ ë©”ì„œë“œ ì´ë¦„ë§Œ ê·œì¹™ì— ë§ê²Œ ì‘ì„±í•˜ë©´ ì¿¼ë¦¬ë¥¼ ì§ì ‘ ì‘ì„±í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ì ì…ë‹ˆë‹¤. Springì´ ì•Œì•„ì„œ SQLë¡œ ë³€í™˜í•´ì„œ ì‹¤í–‰í•´ì¤ë‹ˆë‹¤.

#### @Query: ì§ì ‘ ì¿¼ë¦¬ ì‘ì„±í•˜ê¸°

ë©”ì„œë“œ ì´ë¦„ë§Œìœ¼ë¡œëŠ” ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ë§Œë“¤ê¸° ì–´ë ¤ìš¸ ë•Œê°€ ìˆìŠµë‹ˆë‹¤. ì´ëŸ´ ë•Œ `@Query` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì„œ ì§ì ‘ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

##### ê¸°ë³¸ ì‚¬ìš©ë²•

`@Query` ì–´ë…¸í…Œì´ì…˜ì„ ë©”ì„œë“œ ìœ„ì— ë¶™ì´ê³ , ê´„í˜¸ ì•ˆì— ì¿¼ë¦¬ë¥¼ ë¬¸ìì—´ë¡œ ì‘ì„±í•©ë‹ˆë‹¤.

```java
public interface SeatRepository extends JpaRepository<Seat, Long> {
    
    @Query("SELECT s FROM Seat s WHERE s.seatNumber = ?1")
    Seat findBySeatNumber(String seatNumber);
}
```

ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì 

- `SELECT s FROM Seat s`ëŠ” **JPQL(Java Persistence Query Language)**ì…ë‹ˆë‹¤.
    
- SQLê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ, **í…Œì´ë¸” ì´ë¦„ì´ ì•„ë‹ˆë¼ Entity í´ë˜ìŠ¤ ì´ë¦„**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    
- `?1`ì€ ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
    

##### íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ë°©ë²•

1. **ìœ„ì¹˜ ê¸°ë°˜ íŒŒë¼ë¯¸í„° (?1, ?2, ...)**
    
    ```Java
    @Query("SELECT s FROM Seat s WHERE s.row = ?1 AND s.isAvailable = ?2")
    List<Seat> findByRowAndAvailable(String row, boolean available);
    ```
    
2. **ì´ë¦„ ê¸°ë°˜ íŒŒë¼ë¯¸í„° (ë” ê¶Œì¥ë¨)**
    
    ```Java
    @Query("SELECT s FROM Seat s WHERE s.row = :row AND s.isAvailable = :available")
    List<Seat> findByRowAndAvailable(@Param("row") String row,
                                        @Param("available") boolean available);
    ```
    

`@Param` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ì´ë¦„ì„ ëª…ì‹œí•˜ë©´ ë” ëª…í™•í•˜ê³  ì•ˆì „í•©ë‹ˆë‹¤.

##### ì‹¤ì „ ì˜ˆì‹œ

ë³µì¡í•œ ì¡°ê±´ ì¡°íšŒ

```Java
@Query("SELECT s FROM Seat s " +
       "WHERE s.isAvailable = true " +
       "AND s.price BETWEEN :minPrice AND :maxPrice " +
       "ORDER BY s.seatNumber")
List<Seat> findAvailableSeatsInPriceRange(
    @Param("minPrice") BigDecimal minPrice,
    @Param("maxPrice") BigDecimal maxPrice);
```

LIKE ê²€ìƒ‰

```Java
@Query("SELECT s FROM Seat s WHERE s.seatNumber LIKE %:keyword%")
List<Seat> searchSeatsByNumber(@Param("keyword") String keyword);
```

COUNT ì¿¼ë¦¬

```Java
@Query("SELECT COUNT(s) FROM Seat s WHERE s.isAvailable = true")
long countAvailableSeats();
```

##### Native SQL ì‚¬ìš©í•˜ê¸°

JPQL ëŒ€ì‹  ì‹¤ì œ SQLì„ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ `nativeQuery = true`ë¥¼ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤.


```Java
@Query(value = "SELECT * FROM seat WHERE is_available = true",
        nativeQuery = true)
List<Seat> findAvailableSeatsNative();
```

**ì£¼ì˜**: Native SQLì€ **í…Œì´ë¸”ëª…ê³¼ ì»¬ëŸ¼ëª…ì„ ê·¸ëŒ€ë¡œ ì¨ì•¼ í•©ë‹ˆë‹¤.** Entity ì´ë¦„ì´ ì•„ë‹™ë‹ˆë‹¤.

##### ì–¸ì œ @Queryë¥¼ ì“¸ê¹Œ?

- **ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ë§Œë“¤ê¸° ì–´ë ¤ìš´ ê²½ìš°**:
    
    - ë³µì¡í•œ JOINì´ í•„ìš”í•  ë•Œ
        
    - ì§‘ê³„ í•¨ìˆ˜(COUNT, SUM, AVG)ë¥¼ ì‚¬ìš©í•  ë•Œ
        
    - ì—¬ëŸ¬ ì¡°ê±´ì´ ë³µì¡í•˜ê²Œ ì„ì—¬ìˆì„ ë•Œ
        
- ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ íŠ¹ì • ì»¬ëŸ¼ë§Œ ì¡°íšŒí•  ë•Œ
    

ê°„ë‹¨í•œ ì¡°íšŒë¼ë©´ ë©”ì„œë“œ ì´ë¦„ ê·œì¹™ì„ ì‚¬ìš©í•˜ê³ , ë³µì¡í•˜ë©´ `@Query`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²Œ ì¼ë°˜ì ì…ë‹ˆë‹¤.

##### í•µì‹¬ ì •ë¦¬

- `@Query`ë¡œ JPQL(ë˜ëŠ” Native SQL) ì§ì ‘ ì‘ì„± ê°€ëŠ¥
    
- íŒŒë¼ë¯¸í„°ëŠ” `?1` ë˜ëŠ” `:name` ë°©ì‹ìœ¼ë¡œ ë°”ì¸ë”©
    
- Entity ì´ë¦„ì„ ì‚¬ìš©í•˜ëŠ” JPQLì´ ê¸°ë³¸, Native SQLì€ `nativeQuery = true` ì˜µì…˜ í•„ìš”
    

---


### Entity ê°„ì˜ ê´€ê³„ ë§¤í•‘ (Relationships)

ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” Entityë“¤ì´ ì„œë¡œ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ PulseTicket í”„ë¡œì íŠ¸ì—ì„œ "ì˜ˆì•½(Reservation)"ì€ "ì¢Œì„(Seat)"ê³¼ "ì‚¬ìš©ì(User)"ë¥¼ ì°¸ì¡°í•´ì•¼ í•˜ì£ . ì´ëŸ° ê´€ê³„ë¥¼ JPAì—ì„œ ì–´ë–»ê²Œ í‘œí˜„í•˜ëŠ”ì§€ ì•Œì•„ë´…ì‹œë‹¤.

#### ê´€ê³„ì˜ ì¢…ë¥˜

ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ê°„ì˜ ê´€ê³„ëŠ” í¬ê²Œ ì„¸ ê°€ì§€ì…ë‹ˆë‹¤:

- **@ManyToOne / @OneToMany**: ë‹¤ëŒ€ì¼ / ì¼ëŒ€ë‹¤ ê´€ê³„
    
- **@OneToOne**: ì¼ëŒ€ì¼ ê´€ê³„
    
- **@ManyToMany**: ë‹¤ëŒ€ë‹¤ ê´€ê³„
    

ê°€ì¥ ìì£¼ ì“°ì´ê³  ì¤‘ìš”í•œ ê±´ `@ManyToOne`ê³¼ `@OneToMany`ì…ë‹ˆë‹¤. ë¨¼ì € ì´ê²ƒë¶€í„° ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤.

#### @ManyToOne: ë‹¤ëŒ€ì¼ ê´€ê³„

"ì—¬ëŸ¬ ê°œ(Many)"ê°€ "í•˜ë‚˜(One)"ë¥¼ ì°¸ì¡°í•˜ëŠ” ê´€ê³„ì…ë‹ˆë‹¤.

**ì‹¤ì „ ì˜ˆì‹œ: Reservation â†’ Seat**

í•˜ë‚˜ì˜ ì¢Œì„ì— ì—¬ëŸ¬ ì˜ˆì•½ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê° ì˜ˆì•½ì€ ì •í™•íˆ í•˜ë‚˜ì˜ ì¢Œì„ì„ ì°¸ì¡°í•©ë‹ˆë‹¤:



```Java
@Entity
public class Reservation {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private LocalDateTime reservedAt;
    
    @ManyToOne
    @JoinColumn(name = "seat_id")
    private Seat seat;
    
    // ìƒì„±ì, getter, setter
}
```

**í•µì‹¬ í¬ì¸íŠ¸**

- **@ManyToOne**: ì—¬ëŸ¬ Reservationì´ í•˜ë‚˜ì˜ Seatë¥¼ ì°¸ì¡°
    
- **@JoinColumn(name = "seat_id")**: ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì™¸ë˜í‚¤ ì»¬ëŸ¼ ì´ë¦„ ì§€ì •
    
- ì´ ì„¤ì •ë§Œìœ¼ë¡œ `reservation` í…Œì´ë¸”ì— `seat_id` ì™¸ë˜í‚¤ ì»¬ëŸ¼ì´ ìë™ ìƒì„±ë©ë‹ˆë‹¤.
    

#### @OneToMany: ì¼ëŒ€ë‹¤ ê´€ê³„ (ë°˜ëŒ€í¸)

í•˜ë‚˜ì˜ Seatì—ì„œ ì—¬ëŸ¬ Reservationì„ ì¡°íšŒí•˜ê³  ì‹¶ë‹¤ë©´, ë°˜ëŒ€í¸ì— `@OneToMany`ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤:

```Java
@Entity
public class Seat {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String seatNumber;
    
    @OneToMany(mappedBy = "seat")
    private List<Reservation> reservations = new ArrayList<>();
    
    // ìƒì„±ì, getter, setter
}
```

**í•µì‹¬ í¬ì¸íŠ¸**

- **@OneToMany(mappedBy = "seat")**: "Reservation ì—”í‹°í‹°ì˜ seat í•„ë“œê°€ ê´€ê³„ì˜ ì£¼ì¸"ì´ë¼ëŠ” ì˜ë¯¸
    
- `mappedBy`ëŠ” ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì— ë°˜ë“œì‹œ í•„ìš”í•©ë‹ˆë‹¤.
    
- ì™¸ë˜í‚¤ëŠ” ì´ë¯¸ Reservation í…Œì´ë¸”ì— ìˆìœ¼ë¯€ë¡œ, Seat ìª½ì—ì„œëŠ” ì¶”ê°€ ì»¬ëŸ¼ì´ ìƒì„±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    

#### ì–‘ë°©í–¥ ê´€ê³„ì˜ í•µì‹¬ ê°œë…

##### ê´€ê³„ì˜ ì£¼ì¸(Owner)

ì–‘ë°©í–¥ ê´€ê³„ì—ì„œëŠ” í•œìª½ë§Œ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ "ê´€ê³„ì˜ ì£¼ì¸"ì´ë¼ê³  í•©ë‹ˆë‹¤:

- **ì£¼ì¸**: `@ManyToOne` ìª½ (Reservation) - ì™¸ë˜í‚¤ê°€ ìˆëŠ” í…Œì´ë¸”
    
- **ì£¼ì¸ ì•„ë‹˜**: `@OneToMany` ìª½ (Seat) - `mappedBy` ì†ì„± ì‚¬ìš©
    

##### ì‹¤ì „ ê·œì¹™

```Java
// ê´€ê³„ ì„¤ì • ì‹œ ì£¼ì¸ ìª½ì—ì„œë§Œ ì„¤ì •í•˜ë©´ DBì— ë°˜ì˜ë©ë‹ˆë‹¤
Reservation reservation = new Reservation();
reservation.setSeat(seat);  // â† ì´ê²ƒë§Œ í•´ë„ DBì— ì €ì¥ë¨
reservationRepository.save(reservation);

// ë°˜ëŒ€í¸ë„ ì„¤ì •í•˜ë©´ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤ (ê¶Œì¥)
seat.getReservations().add(reservation);
```

##### ì‹¤ì „ íŒ

PulseTicket í”„ë¡œì íŠ¸ ì ìš© ì˜ˆì‹œ:

```Java
@Entity
public class Reservation {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    // Many reservations â†’ One seat
    @ManyToOne
    @JoinColumn(name = "seat_id")
    private Seat seat;
    
    // Many reservations â†’ One user
    @ManyToOne
    @JoinColumn(name = "user_id")
    private User user;
    
    private LocalDateTime reservedAt;
    private ReservationStatus status;
}
```

ì´ë ‡ê²Œ í•˜ë©´ Reservation í…Œì´ë¸”ì— `seat_id`ì™€ `user_id` ì™¸ë˜í‚¤ ì»¬ëŸ¼ì´ ìƒì„±ë©ë‹ˆë‹¤.

**í•µì‹¬ ì •ë¦¬:**

- `@ManyToOne`ì€ ì™¸ë˜í‚¤ê°€ ìˆëŠ” ìª½(Many ìª½)ì— ì‚¬ìš©
    
- `@OneToMany(mappedBy = "...")`ëŠ” ë°˜ëŒ€í¸ì— ì‚¬ìš©
    
- ê´€ê³„ì˜ ì£¼ì¸ì€ `@ManyToOne` ìª½ì´ë©°, ì—¬ê¸°ì„œë§Œ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.
    

---

### Cascadeì™€ FetchType: ê´€ê³„ì˜ ë™ì‘ ì œì–´

Entity ê´€ê³„ë¥¼ ì„¤ì •í–ˆë‹¤ë©´, ì´ì œ ê´€ê³„ê°€ ì–´ë–»ê²Œ ë™ì‘í• ì§€ë¥¼ ê²°ì •í•´ì•¼ í•©ë‹ˆë‹¤. ë‘ ê°€ì§€ ì¤‘ìš”í•œ ì„¤ì •ì´ ìˆìŠµë‹ˆë‹¤: Cascade(ì˜ì†ì„± ì „ì´)ì™€ FetchType(ì¡°íšŒ ì „ëµ).

#### Cascade Types: ì˜ì†ì„± ì „ì´

CascadeëŠ” ë¶€ëª¨ ì—”í‹°í‹°ì˜ ì‘ì—…ì„ ìì‹ ì—”í‹°í‹°ì— ìë™ìœ¼ë¡œ ì „íŒŒí•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë¶€ëª¨ë¥¼ ì €ì¥í•  ë•Œ ìì‹ë„ í•¨ê»˜ ì €ì¥í•˜ëŠ” ì‹ì…ë‹ˆë‹¤.

##### ì£¼ìš” Cascade Types

**CascadeType.PERSIST**: ë¶€ëª¨ë¥¼ ì €ì¥í•˜ë©´ ìì‹ë„ ì €ì¥

```Java
@Entity
public class Seat {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @OneToMany(mappedBy = "seat", cascade = CascadeType.PERSIST)
    private List<Reservation> reservations = new ArrayList<>();
}

// ì‚¬ìš© ì˜ˆì‹œ
Seat seat = new Seat("A-10");
Reservation reservation = new Reservation();
reservation.setSeat(seat);
seat.getReservations().add(reservation);

seatRepository.save(seat);  // seatë§Œ ì €ì¥í•´ë„ reservationë„ ìë™ ì €ì¥ë¨
```

**CascadeType.REMOVE**: ë¶€ëª¨ë¥¼ ì‚­ì œí•˜ë©´ ìì‹ë„ ì‚­ì œ


```Java
@OneToMany(mappedBy = "seat", cascade = CascadeType.REMOVE)
private List<Reservation> reservations;

// Seatë¥¼ ì‚­ì œí•˜ë©´ ê´€ë ¨ëœ ëª¨ë“  Reservationë„ ìë™ ì‚­ì œ
seatRepository.deleteById(seatId);
```

**CascadeType.ALL**: ëª¨ë“  ì‘ì—…(ì €ì¥, ìˆ˜ì •, ì‚­ì œ ë“±) ì „íŒŒ

```Java

@OneToMany(mappedBy = "seat", cascade = CascadeType.ALL)
private List<Reservation> reservations;
```

##### Cascade ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­

CascadeëŠ” **Parent-Child ê´€ê³„ì—ë§Œ ì‚¬ìš©**í•´ì•¼ í•©ë‹ˆë‹¤. ë¶€ëª¨ê°€ ìì‹ì˜ ìƒëª…ì£¼ê¸°ë¥¼ ì™„ì „íˆ ê´€ë¦¬í•˜ëŠ” ê²½ìš°ì—ë§Œ ì í•©í•©ë‹ˆë‹¤.

- **ì¢‹ì€ ì˜ˆ**: Order â†’ OrderItem (ì£¼ë¬¸ì´ ì£¼ë¬¸í•­ëª©ì„ ì†Œìœ )
    
- **ë‚˜ìœ ì˜ˆ**: Reservation â†’ Seat (ì˜ˆì•½ì´ ì¢Œì„ì„ ì†Œìœ í•˜ì§€ ì•ŠìŒ)
    

#### FetchType: ì¡°íšŒ ì „ëµ

ê´€ê³„ëœ ì—”í‹°í‹°ë¥¼ ì–¸ì œ ì¡°íšŒí• ì§€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.

##### FetchType.LAZY (ì§€ì—° ë¡œë”©)

ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ **ì‹¤ì œë¡œ ì‚¬ìš©í•  ë•Œê¹Œì§€ ì¡°íšŒë¥¼ ë¯¸ë£¹ë‹ˆë‹¤.**



```Java
@Entity
public class Reservation {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "seat_id")
    private Seat seat;
}

// ì‚¬ìš© ì˜ˆì‹œ
Reservation reservation = reservationRepository.findById(1L).orElse(null);
// ì—¬ê¸°ê¹Œì§€ëŠ” Seat ì¡°íšŒ ì¿¼ë¦¬ê°€ ì•ˆ ë‚˜ê°

String seatNumber = reservation.getSeat().getSeatNumber();
// ì´ ìˆœê°„ Seat ì¡°íšŒ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë¨
```

##### FetchType.EAGER (ì¦‰ì‹œ ë¡œë”©)

ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ **ì²˜ìŒ ì¡°íšŒí•  ë•Œ í•¨ê»˜ ì¡°íšŒí•©ë‹ˆë‹¤.**



```Java
@ManyToOne(fetch = FetchType.EAGER)
@JoinColumn(name = "seat_id")
private Seat seat;

// Reservation ì¡°íšŒ ì‹œ Seatë„ JOINí•´ì„œ í•¨ê»˜ ì¡°íšŒ
Reservation reservation = reservationRepository.findById(1L).orElse(null);
// SELECT ... FROM reservation r JOIN seat s ON r.seat_id = s.id
```

##### ê¸°ë³¸ê°’ (Default FetchType)

JPAëŠ” ê´€ê³„ íƒ€ì…ì— ë”°ë¼ ë‹¤ë¥¸ ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:

- **@ManyToOne, @OneToOne**: `EAGER` (ì¦‰ì‹œ ë¡œë”©)
    
- **@OneToMany, @ManyToMany**: `LAZY` (ì§€ì—° ë¡œë”©)
    

##### ê¶Œì¥ ì‚¬í•­: í•­ìƒ LAZYë¥¼ ì‚¬ìš©í•˜ì„¸ìš”

**EAGERëŠ” ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.** ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- **ì˜ˆìƒì¹˜ ëª»í•œ ì¿¼ë¦¬ ë°œìƒ**: ì—”í‹°í‹° í•˜ë‚˜ ì¡°íšŒí–ˆëŠ”ë° ì—°ê´€ëœ ëª¨ë“  ì—”í‹°í‹°ê°€ JOINìœ¼ë¡œ ì¡°íšŒë©ë‹ˆë‹¤.
    
- **N+1 ë¬¸ì œ**: JPQL ì‚¬ìš© ì‹œ ê° ì—”í‹°í‹°ë§ˆë‹¤ ì¶”ê°€ ì¿¼ë¦¬ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
- **ì„±ëŠ¥ ì €í•˜**: í•„ìš”í•˜ì§€ ì•Šì€ ë°ì´í„°ê¹Œì§€ í•­ìƒ ì¡°íšŒí•©ë‹ˆë‹¤.
    



```Java
// ê¶Œì¥: ëª¨ë“  ê´€ê³„ë¥¼ LAZYë¡œ ì„¤ì •
@ManyToOne(fetch = FetchType.LAZY)
private Seat seat;

@ManyToOne(fetch = FetchType.LAZY)
private User user;
```

í•„ìš”í•  ë•Œë§Œ ëª…ì‹œì ìœ¼ë¡œ **JOIN FETCH**ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”:



```Java
@Query("SELECT r FROM Reservation r JOIN FETCH r.seat WHERE r.id = :id")
Reservation findByIdWithSeat(@Param("id") Long id);
```

##### ì‹¤ì „ ê¶Œì¥ ì„¤ì •

```Java
@Entity
public class Reservation {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    // LAZY ë¡œë”© ì‚¬ìš© (ê¶Œì¥)
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "seat_id")
    private Seat seat;
    
    // CascadeëŠ” ì‹ ì¤‘í•˜ê²Œ ì‚¬ìš©
    // Reservationì´ Seatë¥¼ ì†Œìœ í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ Cascade ì—†ìŒ
}

@Entity
public class Seat {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    // LAZY ë¡œë”© ì‚¬ìš©
    // í•„ìš”ì‹œì—ë§Œ CASCADE ì„¤ì • (ì˜ˆ: orphanRemoval = true)
    @OneToMany(mappedBy = "seat", fetch = FetchType.LAZY)
    private List<Reservation> reservations = new ArrayList<>();
}
```

**í•µì‹¬ ì •ë¦¬:**

- **Cascade**: ë¶€ëª¨ ì‘ì—…ì„ ìì‹ì—ê²Œ ì „íŒŒ, Parent-Child ê´€ê³„ì—ë§Œ ì‚¬ìš©
    
- **FetchType.LAZY**: ì‹¤ì œ ì‚¬ìš© ì‹œì ì— ì¡°íšŒ (ê¶Œì¥)
    
- **FetchType.EAGER**: ì¦‰ì‹œ ì¡°íšŒ (ì‚¬ìš© ì§€ì–‘)
    
- `@ManyToOne`ì€ ê¸°ë³¸ì´ EAGERì´ë¯€ë¡œ ëª…ì‹œì ìœ¼ë¡œ LAZYë¡œ ë³€ê²½ í•„ìš”
    

#### LAZY ë¡œë”©ì˜ ë™ì‘ ë°©ì‹



```Java
@Entity
public class Reservation {
    @Id
    private Long id;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "seat_id")
    private Seat seat;  // ìì‹ì´ ë¶€ëª¨ë¥¼ ì°¸ì¡°
}
```

##### ë‹¨ê³„ë³„ ë™ì‘

1. **ìì‹ ì—”í‹°í‹° ì¡°íšŒ ì‹œ:**
    
    
    
    ```Java
    Reservation reservation = reservationRepository.findById(1L).orElse(null);
    // SQL: SELECT * FROM reservation WHERE id = 1
    // Seatì€ ì¡°íšŒí•˜ì§€ ì•ŠìŒ!
    ```
    
    ì´ ì‹œì ì—ì„œ `reservation.seat`ëŠ” ì‹¤ì œ Seat ê°ì²´ê°€ ì•„ë‹ˆë¼ **í”„ë¡ì‹œ(Proxy) ê°ì²´**ì…ë‹ˆë‹¤. JPAê°€ ë§Œë“  ê°€ì§œ ê°ì²´ì£ .
    
2. **ë¶€ëª¨ ì—”í‹°í‹°ì— ì ‘ê·¼í•˜ì§€ ì•Šìœ¼ë©´:**
    
    
    
    ```Java
    // Seatì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ Seat ì¡°íšŒ ì¿¼ë¦¬ê°€ ì ˆëŒ€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
    System.out.println(reservation.getId());  // OK, Seat ì¡°íšŒ ì•ˆ í•¨
    ```
    
3. **ë¶€ëª¨ ì—”í‹°í‹°ì— ì‹¤ì œë¡œ ì ‘ê·¼í•˜ëŠ” ìˆœê°„:**
    
    
    
    ```Java
    String seatNumber = reservation.getSeat().getSeatNumber();
    // ì´ ìˆœê°„! Seat ì¡°íšŒ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë¨
    // SQL: SELECT * FROM seat WHERE id = ?
    ```
    
    í”„ë¡ì‹œê°€ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ Seatì„ ì¡°íšŒí•˜ê³ , í”„ë¡ì‹œë¥¼ í†µí•´ ì‹¤ì œ ì—”í‹°í‹°ì— ì ‘ê·¼í•©ë‹ˆë‹¤.
    

##### ë¹„êµ: EAGER vs LAZY

**EAGER (ì¦‰ì‹œ ë¡œë”©)**



```Java
@ManyToOne(fetch = FetchType.EAGER)
private Seat seat;

Reservation reservation = reservationRepository.findById(1L).orElse(null);
// SQL: SELECT * FROM reservation r JOIN seat s ON r.seat_id = s.id
// Seatì„ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë¬´ì¡°ê±´ í•¨ê»˜ ì¡°íšŒë¨!
```

**LAZY (ì§€ì—° ë¡œë”©) - ê¶Œì¥**



```Java
@ManyToOne(fetch = FetchType.LAZY)
private Seat seat;

Reservation reservation = reservationRepository.findById(1L).orElse(null);
// SQL: SELECT * FROM reservation WHERE id = 1
// Seat ì¡°íšŒ ì•ˆ í•¨

String number = reservation.getSeat().getSeatNumber();
// ì´ì œ SQL: SELECT * FROM seat WHERE id = ?
```

##### í•µì‹¬ ìš”ì•½

- ìì‹ ì—”í‹°í‹° ì¡°íšŒ ì‹œ: ìì‹ë§Œ ì¡°íšŒ, ë¶€ëª¨ëŠ” í”„ë¡ì‹œë¡œ ëŒ€ì²´
    
- ë¶€ëª¨ì— ì ‘ê·¼í•˜ì§€ ì•Šìœ¼ë©´: ë¶€ëª¨ ì¡°íšŒ ì¿¼ë¦¬ ì ˆëŒ€ ì‹¤í–‰ ì•ˆ ë¨
    
- ë¶€ëª¨ì— ì‹¤ì œë¡œ ì ‘ê·¼í•˜ë©´: ê·¸ë•Œ ë¶€ëª¨ ì¡°íšŒ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë¨
    
- ì´ê²Œ ë°”ë¡œ LAZY ë¡œë”©ì´ ì„±ëŠ¥ ìµœì í™”ì— ì¢‹ì€ ì´ìœ ì…ë‹ˆë‹¤. í•„ìš”í•˜ì§€ ì•Šì€ ë°ì´í„°ëŠ” ì¡°íšŒí•˜ì§€ ì•Šìœ¼ë‹ˆê¹Œìš”.
    

---

### Springì—ì„œ @Transactional ì–´ë…¸í…Œì´ì…˜ì€ ë¬´ì—‡ì´ê³  JPAì™€ í•¨ê»˜ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ë‚˜ìš”?

JPAì—ì„œ ë°ì´í„°ë¥¼ ë³€ê²½(ì €ì¥, ìˆ˜ì •, ì‚­ì œ)í•  ë•ŒëŠ” **íŠ¸ëœì­ì…˜(Transaction)**ì´ í•„ìˆ˜ì…ë‹ˆë‹¤. Springì—ì„œëŠ” `@Transactional` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì´ë¥¼ ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### íŠ¸ëœì­ì…˜ì´ë€?

íŠ¸ëœì­ì…˜ì€ ì—¬ëŸ¬ ì‘ì—…ì„ í•˜ë‚˜ì˜ ë‹¨ìœ„ë¡œ ë¬¶ì–´ì„œ, ì „ë¶€ ì„±ê³µí•˜ê±°ë‚˜ ì „ë¶€ ì‹¤íŒ¨í•˜ë„ë¡ ë³´ì¥í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

#### ACID ì†ì„±

íŠ¸ëœì­ì…˜ì€ 4ê°€ì§€ ì†ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤:

- Atomicity (ì›ìì„±): ëª¨ë‘ ì„±ê³µ ë˜ëŠ” ëª¨ë‘ ì‹¤íŒ¨
    
- Consistency (ì¼ê´€ì„±): ë°ì´í„°ë² ì´ìŠ¤ê°€ ìœ íš¨í•œ ìƒíƒœ ìœ ì§€
    
- Isolation (ê²©ë¦¬ì„±): ë™ì‹œ íŠ¸ëœì­ì…˜ë“¤ì´ ì„œë¡œ ì˜í–¥ ì—†ìŒ
    
- Durability (ì§€ì†ì„±): ì„±ê³µí•˜ë©´ ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥
    

#### ì‹¤ì „ ì˜ˆì‹œ

```Java
// ì¢Œì„ ì˜ˆì•½ ì‹œë‚˜ë¦¬ì˜¤
public void reserveSeat(Long seatId, Long userId) {
    // 1. ì¢Œì„ ìƒíƒœë¥¼ "ì˜ˆì•½ë¶ˆê°€"ë¡œ ë³€ê²½
    seat.setAvailable(false);
    
    // 2. ì˜ˆì•½ ë ˆì½”ë“œ ìƒì„±
    Reservation reservation = new Reservation(seat, user);
    reservationRepository.save(reservation);
    
    // ë§Œì•½ 2ë²ˆì—ì„œ ì‹¤íŒ¨í•˜ë©´? 1ë²ˆë„ ì·¨ì†Œë˜ì–´ì•¼ í•¨!
}
```

ì´ëŸ´ ë•Œ íŠ¸ëœì­ì…˜ì´ í•„ìš”í•©ë‹ˆë‹¤.

#### @Transactional ê¸°ë³¸ ì‚¬ìš©ë²•

ë©”ì„œë“œì— `@Transactional`ì„ ë¶™ì´ë©´, ê·¸ ë©”ì„œë“œëŠ” í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.

```Java
@Service
public class ReservationService {

    @Autowired
    private SeatRepository seatRepository;
    
    @Autowired
    private ReservationRepository reservationRepository;
    
    @Transactional
    public void reserveSeat(Long seatId, Long userId) {
        Seat seat = seatRepository.findById(seatId)
            .orElseThrow(() -> new IllegalArgumentException("Seat not found"));
            
        if (!seat.isAvailable()) {
            throw new IllegalStateException("Seat already reserved");
        }
        
        // ì¢Œì„ ìƒíƒœ ë³€ê²½
        seat.setAvailable(false);
        
        // ì˜ˆì•½ ìƒì„±
        Reservation reservation = new Reservation();
        reservation.setSeat(seat);
        reservation.setUserId(userId);
        reservationRepository.save(reservation);
        
        // ì„±ê³µí•˜ë©´ ìë™ìœ¼ë¡œ commit
        // ì˜ˆì™¸ ë°œìƒí•˜ë©´ ìë™ìœ¼ë¡œ rollback
    }
}
```

#### ë™ì‘ ë°©ì‹

- ë©”ì„œë“œ ì‹¤í–‰ ì „: íŠ¸ëœì­ì…˜ ì‹œì‘
    
- ë©”ì„œë“œ ì •ìƒ ì™„ë£Œ: ìë™ìœ¼ë¡œ commit (ë°ì´í„°ë² ì´ìŠ¤ì— ì˜êµ¬ ë°˜ì˜)
    
- ì˜ˆì™¸ ë°œìƒ ì‹œ: ìë™ìœ¼ë¡œ rollback (ëª¨ë“  ë³€ê²½ ì·¨ì†Œ)
    

#### Repositoryì—ëŠ” ì´ë¯¸ @Transactionalì´ ìˆìŒ

`JpaRepository`ì˜ ë©”ì„œë“œë“¤(`save`, `delete` ë“±)ì€ ì´ë¯¸ ë‚´ë¶€ì ìœ¼ë¡œ `@Transactional`ì´ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```Java
// SimpleJpaRepository ë‚´ë¶€ êµ¬í˜„ (Spring Data JPA)
@Transactional
public <S extends T> S save(S entity) {
    // ...
}
```

í•˜ì§€ë§Œ ì—¬ëŸ¬ Repository í˜¸ì¶œì„ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ìœ¼ë ¤ë©´, Service ë ˆì´ì–´ì—ì„œ `@Transactional`ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

#### ì½ê¸° ì „ìš© íŠ¸ëœì­ì…˜

ì¡°íšŒë§Œ í•˜ëŠ” ê²½ìš° `readOnly = true`ë¥¼ ì‚¬ìš©í•˜ë©´ ì„±ëŠ¥ì´ í–¥ìƒë©ë‹ˆë‹¤.

```Java
@Transactional(readOnly = true)
public List<Seat> getAvailableSeats() {
    return seatRepository.findByIsAvailableTrue();
}
```

##### ì¥ì 

- ì„±ëŠ¥ ìµœì í™” (Hibernateê°€ flushë¥¼ ì•ˆ í•¨)
    
- ë°ì´í„°ë² ì´ìŠ¤ì— íŒíŠ¸ ì œê³µ
    
- ì˜ë„ë¥¼ ëª…í™•íˆ í‘œí˜„ (ì´ ë©”ì„œë“œëŠ” ì½ê¸°ë§Œ í•¨)
    

#### ê¶Œì¥ ì‚¬ìš© íŒ¨í„´

Service ë ˆì´ì–´ì— `@Transactional` ì‚¬ìš©

```Java
@Service
@Transactional(readOnly = true)  // í´ë˜ìŠ¤ ë ˆë²¨: ê¸°ë³¸ì€ ì½ê¸° ì „ìš©
public class SeatService {

    // ì¡°íšŒ ë©”ì„œë“œëŠ” í´ë˜ìŠ¤ ë ˆë²¨ ì„¤ì • ì‚¬ìš©
    public Seat getSeat(Long id) {
        return seatRepository.findById(id).orElse(null);
    }
    
    // ë³€ê²½ ë©”ì„œë“œë§Œ ëª…ì‹œì ìœ¼ë¡œ readOnly = false (ê¸°ë³¸ê°’)
    @Transactional
    public Seat reserveSeat(Long seatId, Long userId) {
        // ì˜ˆì•½ ë¡œì§
    }
}
```

##### Repositoryì—ëŠ” ì•ˆ ë¶™ì—¬ë„ ë¨

```Java
// RepositoryëŠ” ê·¸ëŒ€ë¡œ ë‘ë©´ ë¨
public interface SeatRepository extends JpaRepository<Seat, Long> {
    List<Seat> findByIsAvailableTrue();
}
```

#### ì‹¤ì „ PulseTicket ì˜ˆì‹œ

```Java
@Service
@Transactional(readOnly = true)
public class TicketService {

    @Autowired
    private SeatRepository seatRepository;
    
    @Autowired
    private ReservationRepository reservationRepository;
    
    // ì¡°íšŒ: readOnly ì‚¬ìš©
    public List<Seat> getAvailableSeats() {
        return seatRepository.findByIsAvailableTrue();
    }
    
    // ë³€ê²½: íŠ¸ëœì­ì…˜ í•„ìš”
    @Transactional
    public Reservation createReservation(Long seatId, Long userId) {
        Seat seat = seatRepository.findById(seatId)
            .orElseThrow(() -> new EntityNotFoundException("Seat not found"));
            
        if (!seat.isAvailable()) {
            throw new IllegalStateException("Seat already reserved");
        }
        
        // ì¢Œì„ ìƒíƒœ ë³€ê²½
        seat.setAvailable(false);
        seatRepository.save(seat);
        
        // ì˜ˆì•½ ìƒì„±
        Reservation reservation = new Reservation();
        reservation.setSeat(seat);
        reservation.setUserId(userId);
        reservation.setReservedAt(LocalDateTime.now());
        
        return reservationRepository.save(reservation);
        // ì—¬ê¸°ì„œ exception ë°œìƒí•˜ë©´ seat.setAvailable(false)ë„ ë¡¤ë°±ë¨!
    }
    
    // ì·¨ì†Œ: íŠ¸ëœì­ì…˜ í•„ìš”
    @Transactional
    public void cancelReservation(Long reservationId) {
        Reservation reservation = reservationRepository.findById(reservationId)
            .orElseThrow(() -> new EntityNotFoundException("Reservation not found"));
            
        Seat seat = reservation.getSeat();
        seat.setAvailable(true);
        
        reservationRepository.delete(reservation);
        // ë‘˜ ë‹¤ ì„±ê³µí•˜ê±°ë‚˜ ë‘˜ ë‹¤ ì‹¤íŒ¨
    }
}
```

#### í•µì‹¬ ì •ë¦¬

- `@Transactional`ì€ ë©”ì„œë“œë¥¼ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ìŒ
    
- ì„±ê³µí•˜ë©´ commit, ì‹¤íŒ¨í•˜ë©´ rollback ìë™ ì²˜ë¦¬
    
- Service ë ˆì´ì–´ì— ì‚¬ìš©, RepositoryëŠ” ì´ë¯¸ ì ìš©ë˜ì–´ ìˆìŒ
    
- ì¡°íšŒë§Œ í•˜ëŠ” ë©”ì„œë“œëŠ” `readOnly = true` ì‚¬ìš©
    

### ì§€ê¸ˆê¹Œì§€ ë°°ìš´ ë‚´ìš©ê³¼ ì•ìœ¼ë¡œ ë°°ìš¸ í•µì‹¬ í† í”½ì€ ë¬´ì—‡ì¸ê°€ìš”?

ì§€ê¸ˆê¹Œì§€ ë°°ìš´ ë‚´ìš©ê³¼ ì•ìœ¼ë¡œ PulseTicket í”„ë¡œì íŠ¸ë¥¼ ìœ„í•´ ë°°ìš¸ ì¤‘ìš”í•œ ë‹¨ê³„ë“¤ì„ ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.

#### ì§€ê¸ˆê¹Œì§€ ë°°ìš´ ê²ƒ âœ…

- Entity í´ë˜ìŠ¤ ê¸°ë³¸ - @Entity, @Id
    
- Repository ì¸í„°í˜ì´ìŠ¤ - JpaRepository ìƒì†
    
- Query Methods - ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ì¿¼ë¦¬ ìë™ ìƒì„±
    
- @Query - JPQL/Native SQLë¡œ ì§ì ‘ ì¿¼ë¦¬ ì‘ì„±
    
- Entity ê´€ê³„ - @ManyToOne, @OneToMany
    
- Cascade & FetchType - ì˜ì†ì„± ì „ì´, ì§€ì—°/ì¦‰ì‹œ ë¡œë”©
    
- @Transactional - íŠ¸ëœì­ì…˜ ê´€ë¦¬
    

#### ì•ìœ¼ë¡œ ë°°ìš¸ ì¤‘ìš”í•œ ë‹¨ê³„ ğŸ“š

- **1. ID ìƒì„± ì „ëµ (ë“œë””ì–´!)**
    
    - @GeneratedValueì˜ ì „ëµë“¤ (IDENTITY, SEQUENCE, TABLE, AUTO)
        
    - PulseTicketì—ì„œ ì–´ë–¤ ì „ëµì„ ì¨ì•¼ í•˜ëŠ”ì§€
        
- **2. N+1 ë¬¸ì œì™€ í•´ê²°ë²•**
    
    - LAZY ë¡œë”©ì˜ í•¨ì •
        
    - @EntityGraph, JOIN FETCHë¡œ í•´ê²°í•˜ê¸°
        
    - PulseTicketì—ì„œ ì¢Œì„ ëª©ë¡ ì¡°íšŒ ì‹œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œ
        
- **3. Pagination & Sorting**
    
    - ëŒ€ëŸ‰ì˜ ì¢Œì„ ë°ì´í„°ë¥¼ í˜ì´ì§€ë¡œ ë‚˜ëˆ  ì¡°íšŒ
        
    - Pageable, Sort ì‚¬ìš©ë²•
        
    - PulseTicketì—ì„œ ì¢Œì„ ëª©ë¡ì„ íš¨ìœ¨ì ìœ¼ë¡œ ë³´ì—¬ì£¼ê¸°
        
- **4. Auditing (ìƒì„±/ìˆ˜ì • ì‹œê° ìë™ ê´€ë¦¬)**
    
    - @CreatedDate, @LastModifiedDate
        
    - ì˜ˆì•½ ì‹œê°, ìˆ˜ì • ì‹œê° ìë™ ê¸°ë¡
        
- **5. Optimistic Locking (ë‚™ê´€ì  ì ê¸ˆ)**
    
    - @Versionìœ¼ë¡œ ë™ì‹œì„± ì œì–´
        
    - ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— ê°™ì€ ì¢Œì„ ì˜ˆì•½ ì‹œë„í•  ë•Œ ì²˜ë¦¬
        
- **6. Custom Repository êµ¬í˜„**
    
    - ë³µì¡í•œ ë™ì  ì¿¼ë¦¬ ì‘ì„±
        
    - Specification API ì‚¬ìš©
        

#### PulseTicket í”„ë¡œì íŠ¸ ê´€ì ì—ì„œ ìš°ì„ ìˆœìœ„

##### ì¦‰ì‹œ í•„ìš”í•œ ê²ƒ (ë‹¤ìŒ 3-4ë‹¨ê³„)

- ID ìƒì„± ì „ëµ - Entity ì„¤ê³„ ì™„ì„±ì— í•„ìˆ˜
    
- N+1 ë¬¸ì œ í•´ê²° - ì„±ëŠ¥ ìµœì í™”ì˜ í•µì‹¬
    
- Optimistic Locking - í‹°ì¼“íŒ… ì‹œìŠ¤í…œì˜ ë™ì‹œì„± ì œì–´ í•„ìˆ˜
    
- Pagination - ì¢Œì„ ëª©ë¡ ì¡°íšŒ ìµœì í™”
    

##### ë‚˜ì¤‘ì— ë°°ì›Œë„ ë˜ëŠ” ê²ƒ

- Auditing (ìˆìœ¼ë©´ ì¢‹ì§€ë§Œ í•„ìˆ˜ ì•„ë‹˜)
    
- Custom Repository (ë³µì¡í•œ ì¿¼ë¦¬ê°€ í•„ìš”í•  ë•Œ)
    
- Specification API (ë™ì  ì¿¼ë¦¬ê°€ ë§ì„ ë•Œ)
    

ë‹¤ìŒ ë‹¨ê³„ë¡œ ID ìƒì„± ì „ëµë¶€í„° ì‹œì‘í• ê¹Œìš”? ì•„ë‹ˆë©´ ë‹¤ë¥¸ ê²Œ ê¶ê¸ˆí•œê°€ìš”?





---
## Singleton Pattern êµ¬í˜„ ë°©ì‹ 3ê°€ì§€

1. Private

```java
public class EagerSingleton { 
	private static final EagerSingleton INSTANCE = new EagerSingleton(); 
	private EagerSingleton() {} 
	public static EagerSingleton getInstance() { 
		return INSTANCE; 
	} 
}
```


2. Lazy

```java
public class LazyThreadSafeSingleton { 
	private static LazyThreadSafeSingleton instance; 
	private LazyThreadSafeSingleton() {} 
	public static synchronized LazyThreadSafeSingleton getInstance() { 
		if (instance == null) { 
			instance = new LazyThreadSafeSingleton(); 
		} 
		return instance; 
	} 
}
```

Lazy ëŠ” ì´ìŠˆê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ 
-> Synchronized í‚¤ì›Œë“œ ë•Œë¬¸.

3. Enum

```java
// Enum singleton - the preferred approach 
public enum Elvis { 
	INSTANCE; public void leaveTheBuilding() { ... } 
}
```





