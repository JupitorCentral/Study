# JPA

## JPA 테스트 문제


https://github.com/f-lab-edu/PulseTicket/wiki/JPA---%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8-%EC%BA%90%EC%8B%B1/_edit


## JPA Persistence Context

JPA 에선, EntityManager 는 persistence context 라는걸 갖는다.
이 컨텍스트는 EntityManagerFactorycreateEntityManager 를 내가 호출했을때 생성된다.
컨텍스트는 EntityManagerclose 을 호출할때 사라진다.

어린아이 설명: 상자 하나를 생각해. 이 상자(persistence context)에 장난감(엔티티)을 넣으면, 엄마(Hibernate)가 언제든 확인해서 "이 장난감 깨졌어? 새 거로 바꿔?" 하며 DB에 반영해. 상자 안 장난감들은 변경 추적(dirty checking)이 자동으로 돼.


## JPA 의 기본 메커니즘

JPA 의 핵심 : 엔티티의 상태 관리 (Transient, Managed/Persistent, Detached, Removed)
Persistence Context에서 변경 추적(dirty checking) 후 
-> flush/commit으로 DB 동기화

new 객체(Transient)는 변경해도 DB 무시, find()로 로드(Persistent) 후 변경해야 업데이트
-> 뭔 개소리야 이게 ?

"영속화"는 엔티티가 Persistence Context에 등록되어 Hibernate가 상태를 관리하는 상태(managed/persistent).
Context 밖(Transient/Detached)엔 변경 추적 안 돼. ID 유무로 상태 판별: ID null이면 Transient.



### ## DB 저장 시점과 방법 (INSERT/UPDATE)

1. **INSERT (신규 생성)**:
    
    - persist() 호출 → Transient → Persistent 전환, Context 등록.
        
    - ID 자동 생성(GenerationType.AUTO/IDENTITY/SEQUENCE).
        
    - 변경 시 Dirty Checking (스냅샷 복사본과 비교).
        
    - 저장 트리거: em.flush() 명시적 호출, 또는 자동(쿼리 전, commit 전, Always 전략).
        
    - Commit 시 실제 DB INSERT.

#### 스냅샷 ?

>Hibernate detects the changed name by comparing the Item with a snapshot copy it took before, when the Item was loaded from the database.

스냅샷(snapshot)은 “엔티티가 처음 DB에서 로딩되었을 때(or 처음 저장되었을 때)의 상태를 복사해 둔 것”이야.
이 복사본을 Persistence Context 안에 Hibernate가 내부적으로 들고 있어. 개발자가 직접 보는 객체가 아님.

스냅샷은 DB에 있는 게 아니라, Persistence Context(1차 캐시) 내부의 메모리 구조에 저장된 “원본 상태 복사본”

- Persistence Context 안에는 “현재 객체 참조” + “그 객체의 옛날 상태(snapshot)” 두 개가 따로 있다.

```java
Persistence Context:
  - managedEntities:
      Item#1  --> 실제 엔티티 인스턴스 (지금 네가 setName() 때리는 그 객체)
  - snapshots:
      Item#1  --> { name="oldName", price=1000, ... }
```


### Dirty Checking + Snapshot 동작 순서

1. `em.find(Item.class, id)`
    
    - DB에서 SELECT 해서 Item 한 줄 읽어온다.
        
    - Persistence Context에 엔티티 인스턴스를 넣는다.
        
    - 동시에 그 시점의 필드 값들을 snapshot으로 복사해 둔다.  
        예: `name="Book"`, `price=1000`.​
        
2. 애플리케이션 코드에서 값 변경:
    
    ```java
    `Item item = em.find(Item.class, id); 
    item.setName("New Book"); // 아직 DB에는 아무 일도 안 일어남`
    ```
    
3. flush 시점 (트랜잭션 commit 직전, 혹은 쿼리 실행 전, 혹은 명시적 `em.flush()`):  
    Hibernate가 이렇게 동작한다고 책이 말해.​
    
    - Persistence Context에 있는 모든 managed 엔티티를 순회.
        
    - 각 엔티티에 대해:
        
        - “현재 값” vs “snapshot 값” 비교.
            
        - 값이 다르면 dirty 상태로 판단 → UPDATE SQL 생성 대상.
            
    - 비교 끝나면:
        
        - 바뀐 필드만(or 모든 컬럼) 포함해서 UPDATE 쿼리 생성해서 DB에 보냄.
            
        - DB 반영 후, “현재 엔티티 상태”를 다시 snapshot으로 복사해서 snapshot을 최신으로 갱신.​
            
4. 그래서 “변경 감지(Dirty Checking)”는 결국  
    “현재 객체”와 “옛날 복사본(snapshot)”을 비교하는 알고리즘이다.


### persist

- “JPA 표준 개념”에서는 `EntityManager.persist()`를 말하고
- “우리가 실제로 쓰는 Spring Data JPA 코드”에서는 주로 `repository.save()`를 쓰지, 직접 `persist()` 안 쓰는 경우가 많아.

```java
Reservation reservation = Reservation.reserve(user, seat);
reservationRepository.save(reservation);
```

실제로 내부에선

- 새 엔티티: `entityManager.persist(entity);`
- 이미 있는 엔티티: `entityManager.merge(entity);`

- `repository.save(newEntity)` 호출 → 내부적으로 `EntityManager.persist()` → Transient → Persistent 전환, Persistence Context 등록.










## IllegalArgumentException

이건 왠만하면 breakpoint 로 걸어두지 말자.

각종 framework, package 내부에서 엄청 쓰는데

일부러 이 exception 발생시키고 내부에서 catch 하는식으로 사용하는 경우가 많다.

이러면 내 코드에서 발생한거랑 무관하게 breakpoint 가 계속 걸린다. 실제로 내부적으로 그걸 다 처리하는데도.




# 너무 어려운 내용을 만났을떄

너무 어려운 내용을 만나면, “머리가 나빠서”가 아니라 뇌의 작업 기억이 과부하(cognitive load) 걸린 거라 보면 된다. 이럴 때는 개념을 잘게 쪼개고, 쉬운 설명으로 다시 말해 보고, 여러 설명을 돌려보면서 단계적으로 난이도를 조절하는 쪽이 훨씬 효율적이다.[vedantu+3](https://www.vedantu.com/blog/7-effective-ways-to-understand-difficult-topics)​

## 왜 ‘너무 어렵다’고 느끼는지

교육 심리학의 Cognitive Load Theory(인지 부하 이론)는, 사람의 작업 기억 용량이 제한돼 있어서 한 번에 처리해야 할 정보가 너무 많으면 학습이 확 떨어진다고 설명한다. 이 이론에선 복잡한 작업을 작은 단계로 쪼개고, 예제 해설(worked examples)부터 보고 점점 스스로 풀게 하는 식의 “simple-to-complex sequencing”이 이해도와 성능을 올린다고 권장한다.[chartered+2](https://my.chartered.college/early-career-hub/cognitive-load-theory-and-its-application-in-the-classroom/)​

즉, 한 챕터를 통으로 “이해하려고” 달려드는 순간 이미 작업 기억 한계를 넘겼을 가능성이 크다. 어려움을 느끼는 건 능력 부족이 아니라 설계(교재, 설명, 공부 방식)가 작업 기억에 안 맞게 짜여 있어서일 수 있다는 걸 먼저 인정하는 게 중요하다.[achology+1](https://achology.com/psychology/understanding-the-cognitive-load-theory-experiment/)​

## 이해를 뚫는 기본 전략 세 가지

- 개념을 쪼개고 핵심부터 잡기: 학습 전략 글에서는 “어려운 개념을 핵심 구성 요소로 분해하고, 그 중 가장 중요한 원리부터 이해하라”고 권한다.[vedantu](https://www.vedantu.com/blog/7-effective-ways-to-understand-difficult-topics)​
    
    - 실전에서는 “이 파트에서 저자가 말하려는 한 줄 요약이 뭐지?”를 먼저 적고, 그 한 줄을 지탱하는 정의·공식·예시를 목록으로 뽑아보면 된다. 이게 안 되면 아직 ‘한 번 더 쪼개야 하는 단계’라고 보면 된다.[achology+1](https://achology.com/psychology/understanding-the-cognitive-load-theory-experiment/)​
        
- Feynman Technique(설명하면서 배우기): Feynman 기법은 (1) 개념을 선택하고, (2) 5살짜리/초등학생에게 설명하듯 정말 쉬운 말로 써 보고, (3) 막히는 부분을 찾아 다시 자료를 보고 채우고, (4) 설명을 다듬고 테스트하는 4단계를 제안한다.[keephustlingtech+3](https://www.keephustlingtech.com/p/learning-made-simple-the-feynman)​
    
    - “이게 뭔지 아느냐?”가 아니라 “프로그래밍 안 하는 친구에게 3~4문장으로 설명해 줄 수 있냐?”를 기준으로 보면, 진짜 이해한 부분과 헛갈리는 부분이 아주 선명하게 드러난다.[fs+1](https://fs.blog/feynman-technique/)​
        
- 여러 설명과 예시를 일부러 찾기: 한 설명이 안 먹히면, 교재·아티클·영상·다른 강사의 강의처럼 서로 다른 소스를 의도적으로 돌려보라는 조언이 많다. 또 어떤 학습 가이드는 “어려운 개념을 자신의 경험과 연결되는 예시로 직접 만들어 보라”고 권장하는데, 이렇게 자기 경험과 엮인 예시를 만들면 이해와 기억이 둘 다 좋아진다고 보고한다.[sophia+1](https://www.sophia.org/blog/student-success/how-to-learn-hard-concepts-in-school/)​
    

## 오래 가는 이해를 만드는 루틴

학습 사이트들은 “그냥 읽기만 하는 수동적 공부”보다는, 스스로 문제를 만들고 풀어보거나, 개념을 떠올려 설명해 보는 active recall(능동적 회상)을 반복하라고 강조한다. 예를 들어, “오늘 이해 안 된 부분”만 따로 질문 리스트로 만들고, 하루 뒤·일주일 뒤에 답을 다시 써 보는 식으로 회상·적용 연습을 하면 장기 기억과 이해가 동시에 강화된다는 식이다.[sophia+1](https://www.sophia.org/blog/student-success/how-to-learn-hard-concepts-in-school/)​

또, 한 번에 오래 붙들고 있는 것보다 “짧게 여러 번” 보는 spaced repetition(간격 두고 반복)이 이해와 기억에 더 효과적이라는 연구·실무 조언이 많다. 이때, 앞에서 말한 worked example → 부분 풀이 → 완전한 문제 풀이 같은 난이도 점진 상승 구조로 설계하면 작업 기억 부담을 줄이면서도 도전은 유지할 수 있다는 게 인지 부하 이론 쪽 권장 사항이다.[chartered+3](https://my.chartered.college/early-career-hub/cognitive-load-theory-and-its-application-in-the-classroom/)​

## 이제 네 상황에 맞춰보자

여기까지는 “교과서적인 정답 전략”을 정리한 거고, 실제로는 네 상황에 맞게 커스터마이즈해야 한다. 그래서 아래 질문에 답을 한 번 생각해 봤으면 한다.

1. 요즘 “너무 어렵다” 느끼는 분야가 구체적으로 뭐야? (예: 네트워크, JPA, 수학, 논문 읽기 등)
    
2. 그 내용을 볼 때 보통 어떤 패턴이야? 처음부터 끝까지 읽고 막힌다, 예제 코드를 먼저 본다, 강의만 듣는다 등 네 루틴을 알려줘.
    
3. 지금 쓰는 자료는 뭐야? (특정 책/강의/문서 링크 수준으로 구체적으로)
    

이 세 가지만 알려주면, 위에서 말한 전략 중에서 무엇을 어떻게 적용해야 할지, “내일부터 할 수 있는” 아주 구체적인 공부 플랜으로 다시 잘라서 정리해 줄게.

1. [https://www.vedantu.com/blog/7-effective-ways-to-understand-difficult-topics](https://www.vedantu.com/blog/7-effective-ways-to-understand-difficult-topics)
2. [https://my.chartered.college/early-career-hub/cognitive-load-theory-and-its-application-in-the-classroom/](https://my.chartered.college/early-career-hub/cognitive-load-theory-and-its-application-in-the-classroom/)
3. [https://fs.blog/feynman-technique/](https://fs.blog/feynman-technique/)
4. [https://achology.com/psychology/understanding-the-cognitive-load-theory-experiment/](https://achology.com/psychology/understanding-the-cognitive-load-theory-experiment/)
5. [https://brocku.ca/pedagogical-innovation/resources/cognitive-load-theory/](https://brocku.ca/pedagogical-innovation/resources/cognitive-load-theory/)
6. [https://www.keephustlingtech.com/p/learning-made-simple-the-feynman](https://www.keephustlingtech.com/p/learning-made-simple-the-feynman)
7. [https://kodeskills.com/the-feynman-technique](https://kodeskills.com/the-feynman-technique)
8. [https://www.sahilbloom.com/newsletter/the-feynman-technique](https://www.sahilbloom.com/newsletter/the-feynman-technique)
9. [https://www.sophia.org/blog/student-success/how-to-learn-hard-concepts-in-school/](https://www.sophia.org/blog/student-success/how-to-learn-hard-concepts-in-school/)
10. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_f1727bb5-ccc7-4df7-aa5b-46a9dc245a33/6e0c85c1-954a-4c26-8aef-2f1f5c303f8e/Pro-Spring-5.pdf](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_f1727bb5-ccc7-4df7-aa5b-46a9dc245a33/6e0c85c1-954a-4c26-8aef-2f1f5c303f8e/Pro-Spring-5.pdf)
11. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_f1727bb5-ccc7-4df7-aa5b-46a9dc245a33/8eda636e-e109-4194-bdb1-6ae2779396dc/Spring-in-Action-Sixth-Edition.pdf](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_f1727bb5-ccc7-4df7-aa5b-46a9dc245a33/8eda636e-e109-4194-bdb1-6ae2779396dc/Spring-in-Action-Sixth-Edition.pdf)
12. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_f1727bb5-ccc7-4df7-aa5b-46a9dc245a33/bf528828-9ff2-48ea-9931-ba5ae9a7c88c/Pro-Spring-Boot-3.pdf](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_f1727bb5-ccc7-4df7-aa5b-46a9dc245a33/bf528828-9ff2-48ea-9931-ba5ae9a7c88c/Pro-Spring-Boot-3.pdf)
13. [https://okky.kr/articles/1130454](https://okky.kr/articles/1130454)
14. [https://www.megastudy.net/teacher_2007/t_promotion/201906_pr/0618_hwj/event.asp](https://www.megastudy.net/teacher_2007/t_promotion/201906_pr/0618_hwj/event.asp)
15. [https://www.youtube.com/watch?v=SumHao_7byk](https://www.youtube.com/watch?v=SumHao_7byk)
16. [https://namu.wiki/w/%EA%B3%B5%EB%B6%80%20%EC%A1%B0%EC%96%B8?uuid=68dbaad6-304a-4892-b115-bb266fc64a43](https://namu.wiki/w/%EA%B3%B5%EB%B6%80%20%EC%A1%B0%EC%96%B8?uuid=68dbaad6-304a-4892-b115-bb266fc64a43)
17. [https://www.youtube.com/watch?v=_mL2L0ceDio](https://www.youtube.com/watch?v=_mL2L0ceDio)
18. [https://www.youtube.com/watch?v=duLhV6TymfE](https://www.youtube.com/watch?v=duLhV6TymfE)
19. [https://www.reddit.com/r/ADHD/comments/158criq/how_dodid_you_study_in_college/](https://www.reddit.com/r/ADHD/comments/158criq/how_dodid_you_study_in_college/)
20. [https://oxfordlearning.com/the-complete-guide-to-study-skills/](https://oxfordlearning.com/the-complete-guide-to-study-skills/)
21. [https://realdealclass.com/product/zero-to-one/](https://realdealclass.com/product/zero-to-one/)
22. [https://itslearning.com/blog/effective-study-strategies-helping-students-learn-smarter-not-harder](https://itslearning.com/blog/effective-study-strategies-helping-students-learn-smarter-not-harder)
23. [https://education.nsw.gov.au/content/dam/main-education/about-us/educational-data/cese/2017-cognitive-load-theory-practice-guide.pdf](https://education.nsw.gov.au/content/dam/main-education/about-us/educational-data/cese/2017-cognitive-load-theory-practice-guide.pdf)